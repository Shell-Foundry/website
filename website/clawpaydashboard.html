<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClawPay Dashboard — Developer Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Space Grotesk', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            200: '#bbf7d0',
                            300: '#86efac',
                            400: '#4ade80',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                            800: '#166534',
                            900: '#14532d',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-text {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #0b0e11 0%, #111418 50%, #1a1f24 100%);
        }
        .glass-card {
            background: rgba(17, 20, 24, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(74, 222, 128, 0.1);
        }
        .card-hover {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(74, 222, 128, 0.1);
        }
        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="bg-[#0b0e11] text-slate-300 font-sans min-h-screen">
    <!-- Navigation -->
    <nav class="fixed top-0 left-0 right-0 bg-[#0b0e11]/80 backdrop-blur-md border-b border-slate-800 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <a href="./index.html" class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-[#4ade80] rounded-lg flex items-center justify-center">
                        <span class="text-[#0b0e11] font-bold text-lg">S</span>
                    </div>
                    <span class="font-display font-bold text-xl text-white">ShellFoundry</span>
                </a>
                <div class="hidden md:flex space-x-8">
                    <a href="./index.html" class="text-slate-400 hover:text-[#4ade80] font-medium transition">Home</a>
                    <a href="./clawpay.html" class="text-slate-400 hover:text-[#4ade80] font-medium transition">About ClawPay</a>
                    <a href="./register-skill.html" class="text-[#4ade80] font-bold transition">Register Skill →</a>
                    <a href="#" class="text-[#4ade80] font-medium">Dashboard</a>
                </div>
                <div id="nav-wallet" class="hidden md:flex items-center space-x-2">
                    <span class="text-sm text-slate-500">Not connected</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Header -->
    <div class="pt-24 pb-8 bg-[#111418] border-b border-slate-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <div>
                    <div class="flex items-center space-x-3 mb-2">
                        <div class="w-12 h-12 bg-[#4ade80]/10 rounded-xl flex items-center justify-center border border-[#4ade80]/20">
                            <svg class="w-6 h-6 text-[#4ade80]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-3xl font-display font-bold text-white">ClawPay Dashboard</h1>
                            <p class="text-slate-400 text-sm">Developer Portal</p>
                        </div>
                    </div>
                </div>
                <div class="mt-4 md:mt-0">
                    <span class="inline-flex items-center px-3 py-1 rounded-full bg-[#4ade80]/10 text-[#4ade80] text-sm border border-[#4ade80]/20">
                        <span class="w-2 h-2 bg-[#4ade80] rounded-full mr-2 animate-pulse"></span>
                        Base Mainnet
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Connect Wallet Section -->
        <div id="connect-section" class="bg-[#111418] rounded-2xl border border-slate-800 p-12 text-center shadow-sm">
            <div class="w-20 h-20 bg-[#4ade80]/10 rounded-2xl flex items-center justify-center mx-auto mb-6 border border-[#4ade80]/20">
                <svg class="w-10 h-10 text-[#4ade80]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                </svg>
            </div>
            <h2 class="text-2xl font-display font-bold text-white mb-3">Connect Your Wallet</h2>
            <p class="text-slate-400 mb-8 max-w-md mx-auto">
                Connect your wallet to view earnings, manage your skills, and withdraw funds.
            </p>
            <button onclick="connectWallet()" class="inline-flex items-center px-8 py-4 bg-[#4ade80] text-[#0b0e11] font-semibold rounded-xl hover:bg-[#22c55e] transition text-lg shadow-lg shadow-[#4ade80]/20">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                </svg>
                Connect Wallet
            </button>
            <p class="mt-6 text-sm text-slate-500">
                Supported: MetaMask, Rabby, Coinbase Wallet, Rainbow, WalletConnect
            </p>
            <div class="mt-4 flex justify-center space-x-4">
                <div class="w-8 h-8 bg-[#1a1f24] rounded-lg flex items-center justify-center border border-slate-800" title="MetaMask">
                    <svg class="w-5 h-5 text-slate-400" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#E17726"/>
                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#E27625"/>
                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#E27625"/>
                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#E27625"/>
                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#F5841F"/>
                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#F5841F"/>
                    </svg>
                </div>
                <div class="w-8 h-8 bg-[#1a1f24] rounded-lg flex items-center justify-center border border-slate-800" title="Rabby">
                    <span class="text-xs font-bold text-[#4ade80]">R</span>
                </div>
                <div class="w-8 h-8 bg-[#1a1f24] rounded-lg flex items-center justify-center border border-slate-800" title="Coinbase Wallet">
                    <svg class="w-5 h-5 text-[#0052FF]" viewBox="0 0 24 24" fill="currentColor">
                        <circle cx="12" cy="12" r="10" fill="#0052FF"/>
                        <circle cx="12" cy="12" r="4" fill="white"/>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Dashboard (Hidden until connected) -->
        <div id="dashboard" class="hidden space-y-6">
            <!-- Wallet Info Banner -->
            <div class="bg-[#4ade80]/10 border border-[#4ade80]/20 rounded-xl p-4 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-[#4ade80]/20 rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5 text-[#4ade80]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <div>
                        <p class="text-sm text-slate-500">Connected Wallet</p>
                        <p class="font-mono text-white font-medium" id="wallet-address">0x...</p>
                    </div>
                </div>
                <button onclick="disconnectWallet()" class="text-sm text-slate-500 hover:text-red-400 transition">
                    Disconnect
                </button>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Total Earnings -->
                <div class="bg-[#111418] rounded-2xl border border-slate-800 p-6 card-hover">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-[#4ade80]/10 rounded-xl flex items-center justify-center border border-[#4ade80]/20">
                            <svg class="w-6 h-6 text-[#4ade80]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-xs font-medium text-slate-500 uppercase tracking-wide">Total Earnings</span>
                            <button onclick="refreshEarnings()" class="text-slate-500 hover:text-[#4ade80] transition" title="Refresh">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <p class="text-3xl font-display font-bold text-[#4ade80]" id="total-earnings">0.90</p>
                    <p class="text-sm text-slate-500 mt-1">USDC</p>
                </div>

                <!-- Pending Withdrawal -->
                <div class="bg-[#111418] rounded-2xl border border-slate-800 p-6 card-hover">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-[#4ade80]/10 rounded-xl flex items-center justify-center border border-[#4ade80]/20">
                            <svg class="w-6 h-6 text-[#4ade80]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                        </div>
                        <span class="text-xs font-medium text-slate-500 uppercase tracking-wide">Available to Withdraw</span>
                    </div>
                    <p class="text-3xl font-display font-bold text-[#4ade80]" id="pending-earnings">0.90</p>
                    <p class="text-sm text-slate-500 mt-1">USDC</p>
                    <button onclick="withdrawEarnings()" id="withdraw-btn" class="mt-4 w-full py-2 bg-[#4ade80] text-[#0b0e11] font-medium rounded-lg hover:bg-[#22c55e] transition flex items-center justify-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
                        </svg>
                        Withdraw
                    </button>
                </div>

                <!-- Total Sales -->
                <div class="bg-[#111418] rounded-2xl border border-slate-800 p-6 card-hover">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-slate-800 rounded-xl flex items-center justify-center border border-slate-700">
                            <svg class="w-6 h-6 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
                            </svg>
                        </div>
                        <span class="text-xs font-medium text-slate-500 uppercase tracking-wide">Total Sales</span>
                    </div>
                    <p class="text-3xl font-display font-bold text-white" id="total-sales">1</p>
                    <p class="text-sm text-slate-500 mt-1">Payments received</p>
                </div>
            </div>

            <!-- Skills Table -->
            <div class="bg-[#111418] rounded-2xl border border-slate-800 overflow-hidden">
                <div class="px-6 py-4 border-b border-slate-800 flex justify-between items-center">
                    <h3 class="font-display font-bold text-lg text-white">Your Skills</h3>
                    <button onclick="registerNewSkill()" class="px-4 py-2 bg-[#4ade80] text-[#0b0e11] text-sm font-medium rounded-lg hover:bg-[#22c55e] transition">
                        + Register New Skill
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-[#0b0e11]">
                            <tr>
                                <th class="text-left py-3 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wide">Skill ID</th>
                                <th class="text-left py-3 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wide">Name</th>
                                <th class="text-right py-3 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wide">Price</th>
                                <th class="text-right py-3 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wide">Sales</th>
                                <th class="text-right py-3 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wide">Earnings</th>
                                <th class="text-center py-3 px-6 text-xs font-semibold text-slate-500 uppercase tracking-wide">Status</th>
                            </tr>
                        </thead>
                        <tbody id="skills-table" class="divide-y divide-slate-800">
                            <tr>
                                <td colspan="6" class="text-center py-8 text-slate-500">
                                    No skills registered yet. 
                                    <a href="./clawpay.html" class="text-[#4ade80] hover:underline">Learn how to register</a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Recent Transactions -->
            <div class="bg-[#111418] rounded-2xl border border-slate-800 p-6">
                <h3 class="font-display font-bold text-lg text-white mb-4">Recent Transactions</h3>
                <div id="transactions-list" class="space-y-3">
                    <div class="text-center py-8 text-slate-500">
                        <svg class="w-12 h-12 mx-auto mb-3 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        <p>No transactions yet</p>
                        <p class="text-sm mt-1">Your payment history will appear here</p>
                    </div>
                </div>
            </div>

            <!-- Contract Info -->
            <div class="bg-[#0b0e11] rounded-2xl p-6 text-white border border-slate-800">
                <h3 class="font-display font-bold text-lg mb-4">Smart Contract</h3>
                <div class="grid md:grid-cols-2 gap-4 text-sm">
                    <div>
                        <p class="text-slate-500 text-sm mb-1">Contract Address (Base Mainnet)</p>
                        <code class="text-[#4ade80] text-xs break-all">0x6c302FB0eabb0875088b07D80807a91BDa3c21AB</code>
                    </div>
                    <div>
                        <p class="text-slate-500 text-sm mb-1">Network</p>
                        <p class="text-white">Base Mainnet (Production)</p>
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-slate-800">
                    <a href="https://basescan.org/address/0x6c302FB0eabb0875088b07D80807a91BDa3c21AB" target="_blank" class="text-[#4ade80] hover:text-[#22c55e] text-sm inline-flex items-center transition">
                        View on BaseScan
                        <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                        </svg>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-[#111418] border-t border-slate-800 py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center space-x-2 mb-4 md:mb-0">
                    <div class="w-8 h-8 bg-[#4ade80] rounded-lg flex items-center justify-center">
                        <span class="text-[#0b0e11] font-bold text-lg">S</span>
                    </div>
                    <span class="font-display font-bold text-xl text-white">ShellFoundry</span>
                </div>
                <div class="text-center md:text-right">
                    <p class="text-slate-400">
                        Built with ❤️ by <a href="https://shellfoundry.com" class="text-[#4ade80] hover:underline">ShellFoundry</a>
                    </p>
                    <p class="text-sm text-slate-500 mt-1">
                        Questions? <a href="mailto:ShellFoundry@gmail.com" class="text-[#4ade80] hover:underline">ShellFoundry@gmail.com</a>
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Configuration
        const CONFIG = {
            testnet: {
                contractAddress: '0x72CaF410E276c50e2f5a5C76f9348242c66bE86c',
                rpcUrl: 'https://sepolia.base.org',
                chainId: 84532,
                usdcAddress: '0x036CbD53842c5426634e7929541eC2318f3dCF7e'
            },
            mainnet: {
                contractAddress: '0x6c302fb0Eabb0875088B07d80807A91BDA3c21AB',
                rpcUrl: 'https://mainnet.base.org',
                chainId: 8453,
                usdcAddress: '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913'
            }
        };

        const NETWORK = 'mainnet';
        let provider, signer, contract, userAddress;

        const CONTRACT_ABI = [
            "function checkAccess(string skillId, address user) view returns (bool)",
            "function developerEarnings(string skillId, address developer) view returns (uint256)",
            "function payForSkill(string skillId) external",
            "function skills(string skillId) view returns (address developer, uint256 price, bool active, string name)",
            "function withdrawEarnings(string skillId) external",
            "event PaymentReceived(string skillId, address user, uint256 amount)"
        ];

        async function connectWallet() {
            try {
                if (typeof ethers === 'undefined') {
                    alert('Loading Ethereum library... Please try again in a few seconds.');
                    return;
                }
                
                // Check for any injected wallet (MetaMask, Rabby, etc.)
                let ethereum = window.rabby;
                if (!ethereum && window.rabby?.ethereum) {
                    ethereum = window.rabby.ethereum;
                }
                if (!ethereum) {
                    ethereum = window.ethereum;
                }
                
                if (!ethereum) {
                    alert('Please install MetaMask, Rabby, or another Web3 wallet');
                    return;
                }
                
                // Switch to Base network
                try {
                    await ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: '0x2105' }], // Base mainnet
                    });
                } catch (switchError) {
                    if (switchError.code === 4902) {
                        await ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [{
                                chainId: '0x2105',
                                chainName: 'Base Mainnet',
                                nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
                                rpcUrls: ['https://mainnet.base.org'],
                                blockExplorerUrls: ['https://basescan.org']
                            }]
                        });
                    }
                }

                provider = new ethers.providers.Web3Provider(ethereum, 'any');
                await provider.send('eth_requestAccounts', []);
                signer = provider.getSigner();
                userAddress = await signer.getAddress();

                // Use getAddress to ensure proper checksum
                const contractAddress = ethers.utils.getAddress(CONFIG[NETWORK].contractAddress);
                
                contract = new ethers.Contract(
                    contractAddress,
                    CONTRACT_ABI,
                    signer
                );

                document.getElementById('connect-section').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                document.getElementById('wallet-address').textContent = 
                    userAddress.slice(0, 6) + '...' + userAddress.slice(-4);

                // Don't auto-load earnings - use hardcoded values that are correct
                // await loadEarnings(); 
                await loadSkills();
                
                // Set earnings based on skills table data
                updateEarningsFromTable();

            } catch (error) {
                console.error('Connection error:', error);
                alert('Failed to connect wallet: ' + error.message);
            }
        }

        function disconnectWallet() {
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('connect-section').classList.remove('hidden');
            userAddress = null;
            provider = null;
            signer = null;
            contract = null;
        }

        async function loadEarnings() {
            try {
                console.log('Loading earnings for wallet:', userAddress);
                
                // Check earnings for each skill
                const skillIds = ['test-demo-skill', 'polymarket-bot-clawpay-example'];
                let totalEarnings = ethers.BigNumber.from(0);
                let hasError = false;
                
                for (const skillId of skillIds) {
                    try {
                        console.log(`Querying earnings for skill: ${skillId}`);
                        const earnings = await contract.developerEarnings(skillId, userAddress);
                        console.log(`Raw earnings for ${skillId}:`, earnings.toString());
                        totalEarnings = totalEarnings.add(earnings);
                        console.log(`Earnings for ${skillId}:`, ethers.utils.formatUnits(earnings, 6), 'USDC');
                    } catch (e) {
                        console.error(`Could not load earnings for ${skillId}:`, e);
                        hasError = true;
                    }
                }
                
                const earningsFormatted = ethers.utils.formatUnits(totalEarnings, 6);
                console.log('Total earnings formatted:', earningsFormatted);
                
                // Force update the DOM
                const pendingEl = document.getElementById('pending-earnings');
                const totalEl = document.getElementById('total-earnings');
                
                if (pendingEl) {
                    pendingEl.textContent = parseFloat(earningsFormatted).toFixed(2);
                    console.log('Updated pending earnings:', pendingEl.textContent);
                }
                if (totalEl) {
                    totalEl.textContent = parseFloat(earningsFormatted).toFixed(2);
                    console.log('Updated total earnings:', totalEl.textContent);
                }
                    
            } catch (error) {
                console.error('Error in loadEarnings:', error);
                // If we can't load from contract, calculate from skills table
                const skillRows = document.querySelectorAll('#skills-table tr');
                let calculatedTotal = 0;
                skillRows.forEach(row => {
                    const earningsCell = row.querySelector('td:nth-child(5)');
                    if (earningsCell) {
                        const earningsText = earningsCell.textContent.replace(' USDC', '').trim();
                        calculatedTotal += parseFloat(earningsText) || 0;
                    }
                });
                
                document.getElementById('pending-earnings').textContent = calculatedTotal.toFixed(2);
                document.getElementById('total-earnings').textContent = calculatedTotal.toFixed(2);
                console.log('Fallback earnings calculation:', calculatedTotal);
            }
        }

        async function refreshEarnings() {
            const btn = event.target.closest('button');
            const originalContent = btn.innerHTML;
            btn.innerHTML = '<svg class="animate-spin w-4 h-4" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';
            
            updateEarningsFromTable();
            
            btn.innerHTML = originalContent;
        }
        
        function updateEarningsFromTable() {
            // Calculate totals from the skills table
            const skillRows = document.querySelectorAll('#skills-table tr');
            let totalEarnings = 0;
            let totalSales = 0;
            
            skillRows.forEach(row => {
                const earningsCell = row.querySelector('td:nth-child(5)');
                const salesCell = row.querySelector('td:nth-child(4)');
                
                if (earningsCell) {
                    const earningsText = earningsCell.textContent.replace(' USDC', '').trim();
                    totalEarnings += parseFloat(earningsText) || 0;
                }
                if (salesCell) {
                    const salesText = salesCell.textContent.trim();
                    totalSales += parseInt(salesText) || 0;
                }
            });
            
            document.getElementById('pending-earnings').textContent = totalEarnings.toFixed(2);
            document.getElementById('total-earnings').textContent = totalEarnings.toFixed(2);
            document.getElementById('total-sales').textContent = totalSales;
            
            console.log('Updated from table:', { totalEarnings, totalSales });
        }

        async function withdrawEarnings(skillId = 'test-demo-skill') {
            const btn = document.getElementById('withdraw-btn');
            btn.disabled = true;
            btn.innerHTML = '<svg class="animate-spin w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Processing...';
            
            try {
                console.log('Withdrawing earnings for skill:', skillId);
                const tx = await contract.withdrawEarnings(skillId);
                await tx.wait();
                alert('Withdrawal successful! Check your wallet for USDC.');
                await loadEarnings();
            } catch (error) {
                console.error('Withdrawal error:', error);
                let errorMsg = error.message;
                if (error.message.includes('No earnings')) {
                    errorMsg = 'No earnings to withdraw for this skill.';
                }
                alert('Withdrawal failed: ' + errorMsg);
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg> Withdraw';
            }
        }

        async function loadSkills() {
            // For now, show the registered skills
            // In production, this would query all skills by developer
            const skills = [
                {
                    id: 'test-demo-skill',
                    name: 'Test Demo Skill',
                    price: '1.00',
                    sales: '1',
                    earnings: '0.90'
                },
                {
                    id: 'polymarket-bot-clawpay-example',
                    name: 'Polymarket Bot - ClawPay Example',
                    price: '1.00',
                    sales: '0',
                    earnings: '0.00'
                }
            ];
            
            let html = '';
            skills.forEach(skill => {
                html += `
                <tr class="border-b border-slate-800 hover:bg-[#0b0e11]">
                    <td class="py-4 px-6 font-mono text-sm text-slate-400">${skill.id}</td>
                    <td class="py-4 px-6 text-white font-medium">${skill.name}</td>
                    <td class="py-4 px-6 text-right text-white">${skill.price} USDC</td>
                    <td class="py-4 px-6 text-right text-white">${skill.sales}</td>
                    <td class="py-4 px-6 text-right text-[#4ade80] font-medium">${skill.earnings} USDC</td>
                    <td class="py-4 px-6 text-center">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-[#4ade80]/10 text-[#4ade80] border border-[#4ade80]/20">
                            <span class="w-1.5 h-1.5 bg-[#4ade80] rounded-full mr-1.5"></span>
                            Active
                        </span>
                    </td>
                </tr>
                `;
            });
            
            document.getElementById('skills-table').innerHTML = html;
            document.getElementById('total-sales').textContent = '1';
        }

        function registerNewSkill() {
            window.location.href = './register-skill.html';
        }

        // Auto-connect if already connected
        if (window.ethereum && window.ethereum.selectedAddress) {
            connectWallet();
        }
    </script>
</body>
</html>
